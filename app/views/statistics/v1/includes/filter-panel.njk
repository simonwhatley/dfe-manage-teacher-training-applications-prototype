{% set filterOptionsHtml %}

  {{ govukCheckboxes({
    idPrefix: "cycle",
    name: "statisticsOptions[cycle]",
    classes: "govuk-checkboxes--small",
    fieldset: {
      legend: {
        text: "Year received",
        isPageHeading: false,
        classes: "govuk-fieldset__legend--s"
      }
    },
    items: [
      {
        value: "2020 to 2021",
        text: "2020 to 2021" | cycleText,
        checked: checked(data.statisticsOptions.cycle, "2020 to 2021")
      },
      {
        value: "2019 to 2020",
        text: "2019 to 2020" | cycleText,
        checked: checked(data.statisticsOptions.cycle, "2019 to 2020")
      }
    ]
  }) if (showOptions and 'cycle' in showOptions) }}

  {{ govukCheckboxes({
    idPrefix: "status",
    name: "statisticsOptions[status]",
    classes: "govuk-checkboxes--small",
    fieldset: {
      legend: {
        text: "Status",
        classes: "govuk-fieldset__legend--s"
      }
    },
    items: [
      {
        value: "Received",
        text: "Received",
        checked: checked(data.statisticsOptions.status, "Received") == "checked"
      },
      {
        value: "Interviewing",
        text: "Interviewing",
        checked: checked(data.statisticsOptions.status, "Interviewing") == "checked"
      },
      {
        value: "Offered",
        text: "Offered",
        checked: checked(data.statisticsOptions.status, "Offered") == "checked"
      },
      {
        value: "Awaiting conditions",
        text: "Awaiting conditions",
        checked: checked(data.statisticsOptions.status, "Awaiting conditions") == "checked"
      },
      {
        value: "Ready to enroll",
        text: "Ready to enroll",
        checked: checked(data.statisticsOptions.status, "Ready to enroll") == "checked"
      },
       {
        value: "Conditions not met",
        text: "Conditions not met",
        checked: checked(data.statisticsOptions.status, "Conditions not met") == "checked"
      },
      {
        value: "Deferred",
        text: "Deferred",
        checked: checked(data.statisticsOptions.status, "Deferred") == "checked"
      },
      {
        value: "Declined",
        text: "Declined",
        checked: checked(data.statisticsOptions.status, "Declined") == "checked"
      },
      {
        value: "Rejected",
        text: "Rejected",
        checked: checked(data.statisticsOptions.status, "Rejected") == "checked"
      },
      {
        value: "Application withdrawn",
        text: "Application withdrawn",
        checked: checked(data.statisticsOptions.status, "Application withdrawn") == "checked"
      },
      {
        value: "Offer withdrawn",
        text: "Offer withdrawn",
        checked: checked(data.statisticsOptions.status, "Offer withdrawn") == "checked"
      }
    ]
  })  if (showOptions and 'status' in showOptions) }}

  {{ govukCheckboxes({
    idPrefix: "provider",
    name: "statisticsOptions[provider]",
    classes: "govuk-checkboxes--small",
    fieldset: {
      legend: {
        text: "Courses run by",
        classes: "govuk-fieldset__legend--s"
      }
    },
    items: [
      {
        value: data.user.organisations[0].name,
        text: data.user.organisations[0].name,
        checked: checked(data.statisticsOptions.provider, data.user.organisations[0].name) == "checked"
      },
      {
        value: data.user.organisations[1].name,
        text: data.user.organisations[1].name,
        checked: checked(data.statisticsOptions.provider, data.user.organisations[1].name) == "checked"
      }
    ]
  }) if (showOptions and 'trainingProvider' in showOptions) }}

  {#% if checked(data.provider, data.user.organisations[0].name) %}

    {{ govukCheckboxes({
      name: "statisticsOptions[location]",
      classes: "govuk-checkboxes--small",
      fieldset: {
        legend: {
          text: "Training locations for " + data.user.organisations[0].name,
          classes: "govuk-fieldset__legend--s"
        }
      },
      items: [
        {
          value: "Main site",
          text: "Main site",
          checked: checked(data.statisticsOptions.location, "Main site") == "checked"
        },
        {
          value: "Camberley - training location",
          text: "Camberley - training location",
          checked: checked(data.statisticsOptions.location, "Camberley - training location") == "checked"
        },
        {
          value: "Epsom Grinstead - training location",
          text: "Epsom Grinstead - training location",
          checked: checked(data.statisticsOptions.location, "Epsom Grinstead - training location") == "checked"
        },
        {
          value: "Lingfield - training location",
          text: "Lingfield - training location",
          checked: checked(data.statisticsOptions.location, "Lingfield - training location") == "checked"
        }
      ]
    }) }}

  {% endif %#}

  {{ govukCheckboxes({
    idPrefix: "accreditedBody",
    name: "statisticsOptions[accreditedBody]",
    classes: "govuk-checkboxes--small",
    fieldset: {
      legend: {
        text: "Courses ratified by",
        classes: "govuk-fieldset__legend--s"
      }
    },
    items: [
      {
        value: data.accreditedBodies[0].name,
        text: data.accreditedBodies[0].name,
        checked: checked(data.statisticsOptions.accreditedBody, data.accreditedBodies[0].name) == "checked"
      },
      {
        value: data.accreditedBodies[1].name,
        text: data.accreditedBodies[1].name,
        checked: checked(data.statisticsOptions.accreditedBody, data.accreditedBodies[1].name) == "checked"
      }
    ]
  }) if (showOptions and 'accreditedBody' in showOptions) }}

  {#% if subjectItems.length >= subjectItemsDisplayLimit %}

    {{ appCheckboxFilter({
      idPrefix: "subject",
      name: "statisticsOptions[subject]",
      legend: {
        text: "Subject"
      },
      items: subjectItems,
      selectedItems: selectedSubjects,
      classes: "govuk-!-margin-bottom-7"
    }) }}

  {% else %}

    {{ govukCheckboxes({
      idPrefix: "subject",
      name: "statisticsOptions[subject]",
      fieldset: {
        legend: {
          text: "Subject",
          classes: "govuk-fieldset__legend--s"
        }
      },
      items: subjectItems,
      classes: "govuk-checkboxes--small"
    }) }}

  {% endif %#}

  {{ govukCheckboxes({
    idPrefix: "studyMode",
    name: "statisticsOptions[studyMode]",
    classes: "govuk-checkboxes--small",
    fieldset: {
      legend: {
        text: "Full time or part time",
        classes: "govuk-fieldset__legend--s"
      }
    },
    items: [
      {
        value: "Full time",
        text: "Full time",
        checked: checked(data.statisticsOptions.studyMode, "Full time") == "checked"
      },
      {
        value: "Part time",
        text: "Part time",
        checked: checked(data.statisticsOptions.studyMode, "Part time") == "checked"
      }
    ]
  }) if (showOptions and 'studyMode' in showOptions) }}

  {{ govukCheckboxes({
    idPrefix: "fundingType",
    name: "statisticsOptions[fundingType]",
    classes: "govuk-checkboxes--small",
    fieldset: {
      legend: {
        text: "Funding type",
        classes: "govuk-fieldset__legend--s"
      }
    },
    items: [
      {
        value: "Fee paying",
        text: "Fee paying",
        checked: checked(data.statisticsOptions.fundingType, "Fee paying") == "checked"
      },
      {
        value: "Salaried",
        text: "Salaried",
        checked: checked(data.statisticsOptions.fundingType, "Salaried") == "checked"
      },
      {
        value: "Apprenticeship",
        text: "Apprenticeship",
        checked: checked(data.statisticsOptions.fundingType, "Apprenticeship") == "checked"
      }
    ]
  })  if (showOptions and 'fundingType' in showOptions) }}

  {{ govukCheckboxes({
    idPrefix: "subjectLevel",
    name: "statisticsOptions[subjectLevel]",
    classes: "govuk-checkboxes--small",
    fieldset: {
      legend: {
        text: "Subject level",
        classes: "govuk-fieldset__legend--s"
      }
    },
    items: [
      {
        value: "Primary",
        text: "Primary",
        checked: checked(data.statisticsOptions.subjectLevel, "Primary") == "checked"
      },
      {
        value: "Secondary",
        text: "Secondary",
        checked: checked(data.statisticsOptions.subjectLevel, "Secondary") == "checked"
      }
    ]
  }) if (showOptions and 'subjectLevel' in showOptions) }}
{% endset %}

<div class="app-filter">
  <div class="app-filter__header">
    <div class="app-filter__header-title">
      <h2 class="govuk-heading-m">Filters</h2>
    </div>
    <div class="app-filter__header-action">

    </div>
  </div>
  <div class="app-filter__content">
    {% if selectedOptions %}
      <div class="app-filter__selected">
        <div class="app-filter__selected-heading">
          <div class="app-filter__heading-title">
            <h2 class="govuk-heading-m govuk-!-margin-bottom-1">Selected filters</h2>
            <p class="govuk-body"><a class="govuk-link govuk-link--no-visited-state" href="/statistics/remove-all-filters">Clear filters</a></p>
          </div>
        </div>

        {% for category in selectedOptions.categories %}
          <h3 class="govuk-heading-s govuk-!-margin-bottom-0">{{ category.heading.text }}</h3>
          <ul class="app-filter-tags">
            {% for item in category.items %}
              <li><a class="app-filter__tag" href="{{ item.href }}"><span class="govuk-visually-hidden">Remove this filter</span> {{item.text}}</a></li>
            {% endfor %}
          </ul>
        {% endfor %}
      </div>
    {% endif %}
    <div class="app-filter__options">
      <form method="get" accept-charset="UTF-8" novalidate>
        <button class="govuk-button" data-module="govuk-button">
          Apply filters
        </button>
        {{ filterOptionsHtml | safe }}
      </form>
    </div>
  </div>
</div>
